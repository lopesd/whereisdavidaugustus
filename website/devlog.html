<html>
  <head>
    <!-- GOOGLE ANALYTICS -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-180773758-1"></script>
    <script>
      window.dataLayer = window.dataLayer || []
      function gtag(){dataLayer.push(arguments)}
      gtag('js', new Date())
      gtag('config', 'UA-180773758-1')
    </script>


    <!-- TITLE N SHIT -->
    <title>Where is David Augustus? | DEVLOG</title>
    <meta name="description" content="where tho?">
    <meta name="keywords" content="where, is, david, augustus, motorcycle, trip">
    <meta name="author" content="David Augustus Schalkwijk Lopes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CONFIG -->
    <meta charset="utf-8"/>

    <!-- FAVICON -->
    <link rel="icon" href="./assets/favicon.png">

    <!-- CSS -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/devlog.css">
  </head>

  <body>
    <main>
      <!-- HEADER -->
      <div id="header">
        <div id="header-content">
          <a id="header-home-link" href="./index.html">HOME</a>
          <div class="header-vertical-line"></div>
          <a id="header-devlog-link" class="current-page" href="./devlog.html">DEVLOG</a>
        </div>
      </div>

      <div id="main-gutters">
        <div class="devlog-entry">
          <div class="devlog-entry-content"><span class="devlog-entry-date">Thu Oct 29 2020 10:14PM |</span><b> GoPro video and GPS data trimming |</b> My ultimate goal with this feature is to be able to display a GoPro video within a checkin, while the map on the left displays the video's route and an icon that follows along the route in step with the video (basically like an aerial view). I've made some significant steps and have a working prototype, but there are a few more hurdles and design decisions to make before this thing is just the way I want it.

TL;DR: GoPros since the Hero5 sample GPS coordinates multiple times per second while recording. This GPS data, alongside a lot of other telemetry, is encoded as a track within the MP4 files alongside the video and audio streams, in a format called GPMF (GoPro Metadata Format). Which is super cool! A combination of two open-source tools (gpmf-extract and gopro-telemetry) allow you to extract and export the data automatically as GeoJSON, from which you can easily read the lat/lng coordinates array, match them with their corresponding entries in the relative milliseconds array (it's called RelativeMicroSeconds, but it's lying), and voila - you have a route and a timeline for your icon to follow.

Hm. Maybe I should submit a PR for this RelativeMicroSeconds thing. I don't think I've ever actually pushed anything to a significant open source library. 

There is one big hurdle, and it's taken up a decent amount of time to solve to my satisfaction. If you trim any portion of the MP4 that has a GPMF track, the GPMF track becomes unreadle by the libraries I mentioned. It must be because of whatever compression algorithm is being used. The obvious solution is to extract the coordinate data first and then trim both, but that would be super tedious to do manually for every GoPro video I want to trim, so obviously I stood up a local node express server with a simple front-end that lets me pick the trim start and end times, gives me a live preview, trims both the video and metadata, and makes it easy to attach them to a checkin. I'm just trying to enable my artistic side!

The Colorado River checkin (which, as of this writing, no one has peeped yet ðŸ‘€) is the first example of this in action on the live website, though it doesn't have the moving icon yet. Zoom in on the location of the marker and you'll see the route taken by the video. Eventually I want to make that zoom automatic, and obviously I want that moving icon. There's a lot of design considerations to take into account with the automatic zoom, especially on mobile. That's a story for another devlog post.

Just for fun, here's what the server looks like:
</div>
        <img title="you want hovertext? this isn't xkcd" class="devlog-entry-image" src="content/images/tools_server_screenshot.png" />

<div class="devlog-entry-content">
<b>Links:</b>
<a href="https://github.com/JuanIrache/gpmf-extract">gpmf-extract (Github)</a>
<a href="https://github.com/JuanIrache/gopro-telemetry">gopro-telemetry (Github)</a>
<a href="https://geojson.org/">GeoJSON.org</a>
</div>
        </div>

        <div class="devlog-entry">
          <div class="devlog-entry-content"><span class="devlog-entry-date">Tue Oct 20 2020 9:24PM |</span> I'll add an entry here when I push a change or new feature. It's just meant to be a super simple way to share the technical side of what I'm doing. By the way, did you know that the length limit for peeper names has been increased to 40 chars?</div>
        </div>

        <hr>

        <div class="devlog-entry">
          <div class="devlog-entry-content"><b>SHOUT OUTS</b>

<b>Giulio Finestrali</b> was the original peeper - among other things, he helped with AWS Lambda@Edge and fixing caching problems

<b>Ivan Petkov</b> is constantly checking this thing and giving me feedback - he even caught an XSS vuln and proved it by hacking my mainframe. He also holds the record for most peeps

<b>Ari Richtberg</b> was a soundboard and focus mate as I was fixing caching problems and writing templating logic

<b>Sam Posa</b> aka Tham Potha aka Posa-san gets a shout out just because he asked for one</span>
        </div>
      </div>
    </main>
  </body>
</html>